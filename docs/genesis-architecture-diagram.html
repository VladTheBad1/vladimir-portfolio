<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genesis Franchise Platform - Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #1a202c;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        .diagram-section {
            margin-bottom: 60px;
        }
        .diagram-container {
            background: #f7fafc;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .section-title {
            color: #2d3748;
            font-size: 1.8em;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .description {
            color: #4a5568;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .mermaid {
            display: flex;
            justify-content: center;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        .info-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .info-card h3 {
            color: #667eea;
            margin: 0 0 15px 0;
            font-size: 1.2em;
        }
        .info-card ul {
            margin: 0;
            padding-left: 20px;
            color: #4a5568;
        }
        .info-card li {
            margin-bottom: 8px;
        }
        .workflow-step {
            background: #edf2f7;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 8px 8px 0;
        }
        .workflow-step h4 {
            color: #2d3748;
            margin: 0 0 10px 0;
        }
        .workflow-step p {
            color: #4a5568;
            margin: 0;
        }
        .legend {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        .legend-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèóÔ∏è Genesis Franchise Platform</h1>
        <p class="subtitle">Complete System Architecture - From User Signup to Revenue</p>

        <!-- High-Level Architecture -->
        <div class="diagram-section">
            <h2 class="section-title">1. High-Level System Architecture</h2>
            <p class="description">
                The Genesis platform operates as a multi-tenant SaaS with shared infrastructure. Each franchisee gets a sub-business 
                under the Genesis umbrella, eliminating the complexity of individual business setup.
            </p>
            <div class="diagram-container">
                <div class="mermaid">
graph TB
    subgraph "User Layer"
        USERS[End Customers]
        FRANCHISEES[Franchisees]
        ADMIN[Genesis Admin]
    end

    subgraph "Application Layer"
        subgraph "Frontend Services"
            LANDING[Marketing Site<br/>genesis-franchise.com]
            DASHBOARD[Franchisee Dashboard<br/>dashboard.genesis.com]
            BUSINESSES[Business Sites<br/>*.genesis-businesses.com]
        end
        
        subgraph "Backend Services"
            API[REST API<br/>Node.js + Express]
            AUTH[Authentication<br/>Supabase Auth]
            QUEUE[Job Queue<br/>BullMQ]
        end
    end

    subgraph "AI & Processing"
        GPT[GPT-4 API<br/>Content Generation]
        CLAUDE[Claude API<br/>Code Generation]
        CRON[Cron Jobs<br/>Daily Operations]
    end

    subgraph "Data Layer"
        subgraph "Primary Storage"
            PG[(PostgreSQL<br/>Multi-tenant DB)]
            REDIS[(Redis<br/>Cache & Queue)]
        end
        
        subgraph "File Storage"
            S3[AWS S3<br/>Assets & Documents]
        end
    end

    subgraph "Payment Infrastructure"
        STRIPE[Stripe Connect<br/>Payment Processing]
        PAYOUTS[Weekly Payouts<br/>Automated]
    end

    subgraph "Deployment & Hosting"
        VERCEL[Vercel<br/>Frontend Hosting]
        RAILWAY[Railway<br/>Backend Hosting]
        CF[Cloudflare<br/>DNS & CDN]
    end

    USERS --> BUSINESSES
    FRANCHISEES --> DASHBOARD
    ADMIN --> DASHBOARD
    
    BUSINESSES --> API
    DASHBOARD --> API
    LANDING --> API
    
    API --> AUTH
    API --> PG
    API --> REDIS
    API --> QUEUE
    
    QUEUE --> GPT
    QUEUE --> CLAUDE
    QUEUE --> CRON
    
    API --> STRIPE
    STRIPE --> PAYOUTS
    
    BUSINESSES --> VERCEL
    DASHBOARD --> VERCEL
    API --> RAILWAY
    
    CF --> VERCEL
    
    API --> S3

    classDef user fill:#e0e7ff,stroke:#6366f1,stroke-width:2px
    classDef app fill:#d1fae5,stroke:#10b981,stroke-width:2px
    classDef ai fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    classDef data fill:#fee2e2,stroke:#ef4444,stroke-width:2px
    classDef payment fill:#e0f2fe,stroke:#0ea5e9,stroke-width:2px
    classDef infra fill:#f3f4f6,stroke:#6b7280,stroke-width:2px
    
    class USERS,FRANCHISEES,ADMIN user
    class LANDING,DASHBOARD,BUSINESSES,API,AUTH,QUEUE app
    class GPT,CLAUDE,CRON ai
    class PG,REDIS,S3 data
    class STRIPE,PAYOUTS payment
    class VERCEL,RAILWAY,CF infra
                </div>
            </div>
        </div>

        <!-- User Registration Flow -->
        <div class="diagram-section">
            <h2 class="section-title">2. User Registration & Business Creation Flow</h2>
            <p class="description">
                This shows exactly what happens when a new franchisee signs up, from application to live business in 10 minutes.
            </p>
            <div class="diagram-container">
                <div class="mermaid">
sequenceDiagram
    participant User
    participant Landing
    participant API
    participant Stripe
    participant Database
    participant AI
    participant Deploy
    participant Email

    User->>Landing: Visit genesis-franchise.com
    Landing->>User: Show offer ($99 setup)
    User->>Landing: Fill application form
    Landing->>API: Submit application
    
    API->>Database: Create franchisee record
    API->>Stripe: Create customer
    API->>Email: Send approval email
    Email->>User: "You're approved!"
    
    User->>Landing: Click setup link
    Landing->>User: Choose business details
    User->>Landing: Enter payment info
    Landing->>Stripe: Process $99 payment
    Stripe->>API: Payment confirmed
    
    API->>Database: Update franchisee status
    API->>Deploy: Create subdomain
    Deploy->>Deploy: Deploy template
    
    API->>AI: Generate initial content
    AI->>Database: Store sample content
    
    API->>Stripe: Create Connect account
    Stripe->>API: Account created
    
    Deploy->>User: Business is LIVE!
    API->>Email: Send welcome email
    Email->>User: Dashboard access
                </div>
            </div>
        </div>

        <!-- Multi-Tenant Architecture -->
        <div class="diagram-section">
            <h2 class="section-title">3. Multi-Tenant Database Architecture</h2>
            <p class="description">
                Single database with row-level security ensures data isolation while maintaining efficiency.
            </p>
            <div class="diagram-container">
                <div class="mermaid">
graph TB
    subgraph "Shared Tables"
        FRAN[franchisees<br/>- id<br/>- email<br/>- business_name<br/>- subdomain]
        TRANS[transactions<br/>- franchisee_id<br/>- amount<br/>- genesis_fee<br/>- status]
        PAY[payouts<br/>- franchisee_id<br/>- amount<br/>- week<br/>- status]
    end
    
    subgraph "Business-Specific Tables"
        CUST[customers<br/>- franchisee_id<br/>- email<br/>- subscription]
        CONT[content<br/>- franchisee_id<br/>- type<br/>- ai_generated<br/>- approved]
        SUPP[support_tickets<br/>- franchisee_id<br/>- customer_id<br/>- status]
    end
    
    subgraph "System Tables"
        TEMP[templates<br/>- name<br/>- category<br/>- base_price]
        AIOPS[ai_operations<br/>- franchisee_id<br/>- operation<br/>- tokens_used]
        METRICS[metrics<br/>- franchisee_id<br/>- date<br/>- revenue<br/>- customers]
    end
    
    FRAN --> CUST
    FRAN --> CONT
    FRAN --> SUPP
    FRAN --> TRANS
    FRAN --> PAY
    FRAN --> AIOPS
    FRAN --> METRICS
    
    TEMP --> FRAN

    classDef shared fill:#e0e7ff,stroke:#6366f1,stroke-width:2px
    classDef business fill:#d1fae5,stroke:#10b981,stroke-width:2px
    classDef system fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    
    class FRAN,TRANS,PAY shared
    class CUST,CONT,SUPP business
    class TEMP,AIOPS,METRICS system
                </div>
            </div>
        </div>

        <!-- Revenue Flow -->
        <div class="diagram-section">
            <h2 class="section-title">4. Revenue Flow & Payment Processing</h2>
            <p class="description">
                How money flows from customers through Genesis to franchisees, with automatic revenue sharing.
            </p>
            <div class="diagram-container">
                <div class="mermaid">
graph LR
    subgraph "Customer Payment"
        CUST[Customer] -->|$29/month| SITE[Business Site]
    end
    
    subgraph "Genesis Processing"
        SITE -->|Stripe Checkout| STRIPE[Genesis Stripe]
        STRIPE -->|2.9% + $0.30| FEES[Stripe Fees]
        STRIPE -->|$27.85| NET[Net Revenue]
    end
    
    subgraph "Revenue Split"
        NET -->|40%| GENESIS[Genesis: $11.14]
        NET -->|60%| FRANCHISEE[Franchisee: $16.71]
    end
    
    subgraph "Payouts"
        FRANCHISEE -->|Weekly| PAYOUT[Franchisee Bank]
        GENESIS -->|Monthly| TREASURY[Genesis Treasury]
    end
    
    subgraph "Uses"
        TREASURY -->|Infrastructure| COSTS[Hosting, APIs]
        TREASURY -->|Growth| MARKETING[Marketing]
        TREASURY -->|Profit| PROFIT[Net Profit]
    end

    classDef customer fill:#e0f2fe,stroke:#0ea5e9,stroke-width:2px
    classDef processing fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    classDef split fill:#d1fae5,stroke:#10b981,stroke-width:2px
    classDef payout fill:#e0e7ff,stroke:#6366f1,stroke-width:2px
    
    class CUST,SITE customer
    class STRIPE,FEES,NET processing
    class GENESIS,FRANCHISEE split
    class PAYOUT,TREASURY,COSTS,MARKETING,PROFIT payout
                </div>
            </div>
        </div>

        <!-- AI Content Generation Pipeline -->
        <div class="diagram-section">
            <h2 class="section-title">5. AI Content Generation Pipeline</h2>
            <p class="description">
                Automated content creation with human-in-the-loop quality control.
            </p>
            <div class="diagram-container">
                <div class="mermaid">
graph TB
    subgraph "Trigger"
        CRON[Daily Cron Job<br/>3:00 AM UTC]
        EVENT[Customer Request]
        MANUAL[Franchisee Request]
    end
    
    subgraph "Generation"
        QUEUE[Job Queue]
        GPT[GPT-4 API]
        PROMPT[Prompt Engineering<br/>+ Business Context]
        CONTENT[Generated Content]
    end
    
    subgraph "Review Process"
        REVIEW[Review Queue]
        NOTIFY[Email/SMS Alert]
        DASHBOARD[Franchisee Dashboard]
        APPROVE{Approve?}
    end
    
    subgraph "Publishing"
        PUBLISH[Publish to Site]
        EMAIL[Email to Customer]
        SOCIAL[Social Media Post]
    end
    
    subgraph "Feedback Loop"
        METRICS[Performance Metrics]
        IMPROVE[Prompt Improvement]
    end
    
    CRON --> QUEUE
    EVENT --> QUEUE
    MANUAL --> QUEUE
    
    QUEUE --> PROMPT
    PROMPT --> GPT
    GPT --> CONTENT
    CONTENT --> REVIEW
    
    REVIEW --> NOTIFY
    NOTIFY --> DASHBOARD
    DASHBOARD --> APPROVE
    
    APPROVE -->|Yes| PUBLISH
    APPROVE -->|No| PROMPT
    
    PUBLISH --> EMAIL
    PUBLISH --> SOCIAL
    
    PUBLISH --> METRICS
    METRICS --> IMPROVE
    IMPROVE --> PROMPT

    classDef trigger fill:#fee2e2,stroke:#ef4444,stroke-width:2px
    classDef ai fill:#fef3c7,stroke:#f59e0b,stroke-width:2px
    classDef review fill:#e0e7ff,stroke:#6366f1,stroke-width:2px
    classDef publish fill:#d1fae5,stroke:#10b981,stroke-width:2px
    
    class CRON,EVENT,MANUAL trigger
    class QUEUE,GPT,PROMPT,CONTENT ai
    class REVIEW,NOTIFY,DASHBOARD,APPROVE review
    class PUBLISH,EMAIL,SOCIAL,METRICS,IMPROVE publish
                </div>
            </div>
        </div>

        <!-- Daily Operations -->
        <div class="diagram-section">
            <h2 class="section-title">6. Daily Operations Workflow</h2>
            <p class="description">
                What happens automatically every day to keep businesses running.
            </p>
            <div class="workflow-step">
                <h4>3:00 AM - Content Generation</h4>
                <p>AI generates content for all active businesses based on their templates and customer needs.</p>
            </div>
            <div class="workflow-step">
                <h4>8:00 AM - Review Notifications</h4>
                <p>Franchisees receive morning email with pending reviews and overnight metrics.</p>
            </div>
            <div class="workflow-step">
                <h4>Throughout Day - Customer Support</h4>
                <p>AI handles initial responses, escalates complex issues to franchisees.</p>
            </div>
            <div class="workflow-step">
                <h4>6:00 PM - Daily Reports</h4>
                <p>Automated reports sent showing revenue, new customers, and key metrics.</p>
            </div>
            <div class="workflow-step">
                <h4>11:00 PM - Backup & Maintenance</h4>
                <p>Database backups, log rotation, and system health checks.</p>
            </div>
            <div class="workflow-step">
                <h4>Weekly - Payouts</h4>
                <p>Every Monday, process payouts for previous week's earnings.</p>
            </div>
        </div>

        <!-- Component Details -->
        <div class="diagram-section">
            <h2 class="section-title">7. System Components</h2>
            <div class="info-grid">
                <div class="info-card">
                    <h3>üé® Frontend Stack</h3>
                    <ul>
                        <li>Next.js 14 (App Router)</li>
                        <li>TypeScript</li>
                        <li>Tailwind CSS</li>
                        <li>Shadcn/ui Components</li>
                        <li>Framer Motion</li>
                        <li>React Query</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>‚öôÔ∏è Backend Stack</h3>
                    <ul>
                        <li>Node.js + Express</li>
                        <li>Supabase (Auth + DB)</li>
                        <li>PostgreSQL</li>
                        <li>Redis (BullMQ)</li>
                        <li>Webhook handlers</li>
                        <li>Cron job scheduler</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>ü§ñ AI Integration</h3>
                    <ul>
                        <li>OpenAI GPT-4 (content)</li>
                        <li>Rate limiting (cost control)</li>
                        <li>Prompt templates</li>
                        <li>Context injection</li>
                        <li>Response caching</li>
                        <li>Fallback handling</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>üí≥ Payment System</h3>
                    <ul>
                        <li>Stripe Connect</li>
                        <li>Automated splits</li>
                        <li>Weekly payouts</li>
                        <li>Subscription management</li>
                        <li>Refund handling</li>
                        <li>Tax reporting</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>üöÄ Deployment</h3>
                    <ul>
                        <li>Vercel (frontend)</li>
                        <li>Railway (backend)</li>
                        <li>Cloudflare (CDN)</li>
                        <li>GitHub Actions (CI/CD)</li>
                        <li>Automatic SSL</li>
                        <li>Zero-downtime deploys</li>
                    </ul>
                </div>
                
                <div class="info-card">
                    <h3>üìä Monitoring</h3>
                    <ul>
                        <li>Vercel Analytics</li>
                        <li>Sentry (errors)</li>
                        <li>Uptime monitoring</li>
                        <li>Cost tracking</li>
                        <li>Performance metrics</li>
                        <li>User behavior</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <h3>Diagram Legend</h3>
            <div class="legend-item">
                <span class="legend-color" style="background: #e0e7ff;"></span>
                User/Interface Layer
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #d1fae5;"></span>
                Application Services
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #fef3c7;"></span>
                AI/Processing
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #fee2e2;"></span>
                Data Storage
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #e0f2fe;"></span>
                Payment/Financial
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #f3f4f6;"></span>
                Infrastructure
            </div>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#667eea',
                primaryTextColor: '#fff',
                primaryBorderColor: '#5a67d8',
                lineColor: '#5a67d8',
                secondaryColor: '#48bb78',
                tertiaryColor: '#ed8936',
                background: 'white',
                mainBkg: '#667eea',
                secondBkg: '#48bb78',
                tertiaryBkg: '#ed8936'
            },
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>